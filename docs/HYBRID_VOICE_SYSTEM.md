# ðŸŽ¤ SystÃ¨me Vocal Hybride Guardian

## ðŸŽ¯ Vue d'ensemble

Guardian utilise un **systÃ¨me vocal hybride intelligent** qui s'adapte automatiquement Ã  la disponibilitÃ© du rÃ©seau :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GUARDIAN HYBRID VOICE SYSTEM                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚  AUDIO   â”‚                                          â”‚
â”‚  â”‚ CAPTURE  â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚       â”‚                                                â”‚
â”‚       â”œâ”€â”€â”€ DÃ©tection connexion Internet                â”‚
â”‚       â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   AVEC WiFi â”‚              â”‚  SANS WiFi   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                              â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Gemini 2.0 Audio  â”‚        â”‚  Vosk Local     â”‚     â”‚
â”‚  â”‚ âœ… Transcription   â”‚        â”‚ âœ… Transcription â”‚     â”‚
â”‚  â”‚ âœ… Intonation      â”‚        â”‚ âŒ Intonation    â”‚     â”‚
â”‚  â”‚ âœ… Ã‰motion         â”‚        â”‚ âš ï¸ Mots-clÃ©s    â”‚     â”‚
â”‚  â”‚ âœ… Stress vocal    â”‚        â”‚ âš ï¸ Heuristique  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                             â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                     â”‚                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚   ANALYSE    â”‚                          â”‚
â”‚              â”‚  D'URGENCE   â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Comparaison des modes

| CaractÃ©ristique | Gemini 2.0 Audio (Online) | Vosk Local (Offline) |
|----------------|---------------------------|----------------------|
| **Connexion requise** | âœ… WiFi obligatoire | âŒ Fonctionne sans Internet |
| **Transcription** | âœ… Excellente (IA avancÃ©e) | âœ… Bonne (modÃ¨le fr-0.22) |
| **Analyse intonation** | âœ… OUI (ton, stress, panique) | âŒ NON (texte uniquement) |
| **DÃ©tection Ã©motion** | âœ… Voix tremblante, pleurs, cris | âš ï¸ Mots-clÃ©s uniquement |
| **Latence** | ~1-2 secondes (rÃ©seau) | ~100ms (local) |
| **CoÃ»t** | ðŸ’° API payante (minimal) | ðŸ’š Gratuit |
| **PrÃ©cision urgence** | ðŸŽ¯ TrÃ¨s Ã©levÃ©e (+2-3 pts si stress) | ðŸŽ¯ Moyenne (basÃ©e sur texte) |

---

## ðŸ”§ Configuration

### Fichier `config/api_keys.yaml`

```yaml
google_cloud:
  gemini:
    api_key: VOTRE_CLE_API_GEMINI
    model: gemini-2.0-flash-exp
    
    # Configuration hybride
    hybrid_voice:
      enabled: true              # Active le systÃ¨me hybride
      audio_analysis: true       # Analyse vocale (si online)
      offline_fallback: true     # Fallback Vosk automatique
```

---

## ðŸš€ Utilisation

### Exemple 1 : DÃ©tection automatique

```python
from guardian.hybrid_voice_agent import HybridVoiceAgent

# Initialisation
agent = HybridVoiceAgent(config)

# Analyse audio (dÃ©tecte automatiquement WiFi)
result = agent.analyze_audio(audio_bytes)

print(result)
# {
#     "transcription": "Je pense que quelqu'un me suit",
#     "emotion_detected": "stressed",
#     "urgency_boost": +2,  # +2 points si stress dÃ©tectÃ©
#     "method": "gemini_audio",  # ou "vosk_local"
#     "online": True
# }
```

### Exemple 2 : VÃ©rification du statut

```python
status = agent.get_status()
print(status)
# {
#     "mode": "ONLINE",
#     "online": True,
#     "gemini_available": True,
#     "vosk_available": True,
#     "current_method": "gemini_audio"
# }
```

---

## ðŸŽ¯ ScÃ©narios d'utilisation

### ScÃ©nario 1 : Femme suivie avec WiFi âœ…

```
Situation : "Je pense que quelqu'un me suit depuis 10 minutes"
Audio : Voix tremblante, respiration rapide

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODE : ONLINE (Gemini 2.0 Audio)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Transcription : "quelqu'un me suit..."  â”‚
â”‚ Intonation : STRESS Ã‰LEVÃ‰               â”‚
â”‚ Ã‰motion : panic                         â”‚
â”‚ Urgence de base : 7/10                  â”‚
â”‚ Bonus vocal : +3 (voix paniquÃ©e)        â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”       â”‚
â”‚ URGENCE FINALE : 10/10 âš ï¸               â”‚
â”‚ â†’ Email + Police 17 IMMÃ‰DIAT            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ScÃ©nario 2 : Femme suivie SANS WiFi âš ï¸

```
Situation : "Je pense que quelqu'un me suit depuis 10 minutes"
Audio : Voix tremblante (NON dÃ©tectÃ©e)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODE : OFFLINE (Vosk Local)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Transcription : "quelqu'un me suit..."  â”‚
â”‚ Intonation : NON DISPONIBLE             â”‚
â”‚ Mots-clÃ©s : "suivie" dÃ©tectÃ©            â”‚
â”‚ Urgence de base : 7/10                  â”‚
â”‚ Bonus texte : +2 (mot-clÃ© "suivie")     â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”       â”‚
â”‚ URGENCE FINALE : 9/10 âš ï¸                â”‚
â”‚ â†’ Email + Police 17                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**DiffÃ©rence** : En mode offline, on perd +1 point (pas de dÃ©tection vocale du stress), mais reste critique (9/10).

### ScÃ©nario 3 : Crevaison vÃ©lo (pas d'urgence)

```
Situation : "J'ai crevÃ© Ã  vÃ©lo, mais Ã§a va"
Audio : Voix calme, ton normal

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODE : ONLINE (Gemini 2.0 Audio)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Transcription : "crevÃ© Ã  vÃ©lo..."       â”‚
â”‚ Intonation : CALME                      â”‚
â”‚ Ã‰motion : calm                          â”‚
â”‚ Urgence de base : 2/10                  â”‚
â”‚ Bonus vocal : +0 (voix normale)         â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”       â”‚
â”‚ URGENCE FINALE : 2/10 âœ…                â”‚
â”‚ â†’ Aucun email, conseils seulement      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ˆ Impact sur la calibration d'urgence

### Bonus d'urgence selon l'Ã©motion vocale

| Ã‰motion dÃ©tectÃ©e | Bonus | Exemple |
|------------------|-------|---------|
| **Calme** | +0 | Voix normale, pas de stress |
| **StressÃ©** | +2 | Voix lÃ©gÃ¨rement tremblante |
| **Panique** | +3 | Respiration rapide, voix aiguÃ« |
| **Pleurs** | +3 | Sanglots audibles |
| **Cris** | +4 | Volume Ã©levÃ©, dÃ©tresse |

### Exemples d'ajustement

```
Sans analyse vocale (Vosk):
- "Je suis suivie" â†’ 7/10 (texte seulement)

Avec analyse vocale (Gemini Audio):
- "Je suis suivie" (calme) â†’ 7/10 + 0 = 7/10
- "Je suis suivie" (stressÃ©e) â†’ 7/10 + 2 = 9/10 âš ï¸
- "Je suis suivie" (panique) â†’ 7/10 + 3 = 10/10 ðŸš¨
```

---

## ðŸ› ï¸ Installation des dÃ©pendances

### Gemini 2.0 Audio (Mode Online)

```bash
pip install google-generativeai
```

### Vosk (Mode Offline)

```bash
pip install vosk sounddevice numpy
```

**ModÃ¨le Vosk franÃ§ais** :
```bash
cd models
wget https://alphacephei.com/vosk/models/vosk-model-small-fr-0.22.zip
unzip vosk-model-small-fr-0.22.zip
```

---

## âš™ï¸ DÃ©tails techniques

### DÃ©tection de connexion

Le systÃ¨me teste plusieurs endpoints :
1. `https://www.google.com`
2. `https://generativelanguage.googleapis.com` (API Gemini)
3. `https://1.1.1.1` (Cloudflare DNS)

Timeout : 2-3 secondes maximum

### Fallback automatique

```python
def analyze_audio(audio_data):
    # VÃ©rification connexion
    if self._check_internet_connection():
        try:
            # Tentative Gemini Audio
            return self._analyze_with_gemini_audio(audio_data)
        except Exception as e:
            # Si Ã©chec â†’ Fallback Vosk
            return self._analyze_with_vosk(audio_data)
    else:
        # Pas de connexion â†’ Vosk direct
        return self._analyze_with_vosk(audio_data)
```

### DÃ©tection d'Ã©motion par mots-clÃ©s (Fallback)

En mode offline, analyse textuelle :

```python
# Panique (+3 points)
panic_keywords = [
    'au secours', 'aidez-moi', 'vite', 'urgent',
    'je vais mourir', 'aide', 's\'il vous plaÃ®t'
]

# Stress (+2 points)
stress_keywords = [
    'suivie', 'menacÃ©', 'peur', 'perdu',
    'angoissÃ©', 'inquiet', 'mal', 'saigne'
]
```

---

## ðŸ“‹ Recommandations

### Pour une utilisation optimale

1. âœ… **Toujours installer Vosk** (fallback essentiel)
2. âœ… **Activer Gemini Audio** si connexion fiable
3. âœ… **Tester en mode avion** pour valider le fallback
4. âš ï¸ **PrÃ©voir 4G/5G** pour zones sans WiFi

### Cas d'usage

| Situation | Mode recommandÃ© | Raison |
|-----------|----------------|--------|
| Domicile | Gemini Audio | WiFi stable |
| ExtÃ©rieur urbain | Gemini Audio | 4G/5G disponible |
| Campagne/montagne | Vosk Local | RÃ©seau instable |
| Mode avion | Vosk Local | Offline obligatoire |
| Urgence critique | Les deux | Redondance |

---

## ðŸ” SÃ©curitÃ© & ConfidentialitÃ©

### Gemini 2.0 Audio (Online)

- âš ï¸ Audio envoyÃ© Ã  Google Cloud
- ðŸ”’ Chiffrement HTTPS
- ðŸ“ Logs Google (conformitÃ© RGPD)
- â±ï¸ Traitement temps rÃ©el (pas de stockage)

### Vosk Local (Offline)

- âœ… 100% local (aucune donnÃ©e envoyÃ©e)
- âœ… ConfidentialitÃ© totale
- âœ… Pas de logs externes
- âœ… RGPD compliant

**Recommandation** : Pour confidentialitÃ© maximale, utiliser `offline_fallback: true` uniquement.

---

## ðŸ“Š Tests et validation

### Test de fallback

```bash
# DÃ©sactiver WiFi manuellement
# Lancer Guardian
python web/start_web_server.py

# VÃ©rifier les logs
# ðŸ“± Mode OFFLINE: Utilisation de Vosk local âœ…
```

### Test d'analyse vocale

```python
# Test avec intonation stressÃ©e
result = agent.analyze_audio(stressed_audio)
assert result['emotion_detected'] == 'stressed'
assert result['urgency_boost'] >= 2

# Test mode calme
result = agent.analyze_audio(calm_audio)
assert result['emotion_detected'] == 'calm'
assert result['urgency_boost'] == 0
```

---

## ðŸ†˜ FAQ

**Q : Que se passe-t-il si je perds le WiFi pendant une urgence ?**
R : Le systÃ¨me bascule automatiquement sur Vosk local en <2 secondes. Vous perdez l'analyse vocale mais gardez la transcription.

**Q : Puis-je forcer le mode offline ?**
R : Oui, mettez `hybrid_voice.enabled: false` dans la config.

**Q : Vosk est-il aussi prÃ©cis que Gemini ?**
R : Pour la transcription : ~85% vs ~95%. Pour l'Ã©motion : mots-clÃ©s uniquement vs analyse vocale complÃ¨te.

**Q : Quel est le coÃ»t de Gemini Audio ?**
R : ~$0.00025 par minute d'audio (trÃ¨s faible). Voir [tarifs Google](https://ai.google.dev/pricing).

**Q : Peut-on utiliser les deux en parallÃ¨le ?**
R : Non, le systÃ¨me choisit automatiquement le meilleur selon la connexion.

---

## ðŸš€ Roadmap

### AmÃ©liorations futures

- [ ] Analyse multi-langue (en, es, de)
- [ ] DÃ©tection bruit ambiant (cris, sirÃ¨nes)
- [ ] Mode hybride simultanÃ© (Vosk + Gemini)
- [ ] Cache intelligent (derniÃ¨res analyses)
- [ ] Compression audio optimisÃ©e

---

## ðŸ“ž Support

Pour toute question :
- ðŸ“§ Email : support@guardianav.com
- ðŸ“š Documentation : `/docs/`
- ðŸ› Issues : GitHub Issues

---

**Version** : 1.0.0
**DerniÃ¨re mise Ã  jour** : 10 novembre 2025
